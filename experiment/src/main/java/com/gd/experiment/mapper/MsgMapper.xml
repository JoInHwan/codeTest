<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.experiment.mapper.MsgMapper">
	
	<!-- 쪽지 리스트  -->
	<select id="selectMsgList" parameterType="String" resultType="com.gd.experiment.dto.MsgDto">
		SELECT
			msg_num msgNum,
			sender,
			receiver,
			title,
			content,
			send_time sendTime,
			read_time readTime,
			send_del sendDel,
			receive_del receiveDel
		FROM 
			msg
		WHERE
			sender = #{id} OR
			receiver = #{id}
		ORDER BY
			send_time DESC					
	</select>

	<!-- 받은쪽지수 -->
	<select id="msgReceive" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM (
			SELECT
				msg_num msgNum
			FROM 
				msg
			WHERE
				receiver = #{id} AND
				receive_del = 'N') a								
	</select>

<!-- 	 쪽지 읽기처리 (미완)-->
	<update id="updateMsgToRead" parameterType="String">
		UPDATE msg
		SET
			confirm = "Y"
		WHERE 
			receiver = #{id} AND
			stare = '수신' AND
			confirm = 'N'
	</update>
	
	
	<!-- 쪽지쓰기 -->
	<insert id="insertMsg" parameterType="Map">
		Insert INTO
				msg(sender,receiver,title,content)
		VALUES (#{sender},#{receiver},#{title},#{content})		
	</insert>


</mapper>